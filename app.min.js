function replaceStopWords(e,t){return"eng"===t?(e=e.replace(/\s/g,"  "),e.replace(/ (a|about|above|after|against|all|am|an|and|any|are|aren't|as|at|be|because|been|before|being|below|between|both|but|by|can't|cannot|could|couldn't|did|didn't|do|does|doesn't|doing|don't|down|during|each|few|for|from|further|had|hadn't|has|hasn't|have|haven't|having|hehe|'d|he'll|he|here|here's|hers|herself|him|himselfh|is|how|how's|into|is|isn't|it|it's|its|itself|let's|me|more|most|mustn't|my|myself|no|nor|not|of|off|on|once|only|or|other|ought|our|ours|ourselves|out|over|own|same|she|she'd|she'll|she's|should|shouldn't|so|some|such|than|that|that's|the|their|theirs|them|themselves|then|there|there's|these|they|they'd|they'll|they're|they've|this|those|through|to|too|under|until|up|very|was|wasn't|we|we'd|we'll|we're|we've|were|weren't|what|what's|when|when's|where|where's|which|while|who|who's|whom|why|why's|with|won't|would|wouldn't|you|you'd|you'll|you're|you've|your|yours|who|yourself|yourselves) /g," ")):"bul"===t?(e=e.replace(/\s/g,"  "),e.replace(/ (ли|е|а|обаче|въпреки|съм|но|може би|моля|аз|ала|та|че) /g)):void 0}var express=require("express"),app=express(),request=require("request"),cheerio=require("cheerio");app.set("view engine","ejs"),app.use(express["static"]("public"));var fs=require("fs");app.get("/",function(e,t){t.render("home.ejs")}),app.get("/history",function(e,t){t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Content-Type","text/plain"),fs.readFile("history.txt",{},function(e,r){t.end(r)})}),app.get("/answer",function(e,t){t.setHeader("Access-Control-Allow-Origin","*"),e.query.text&&e.query.text.length&&(fs.appendFile("history.txt",e.query.text+"^_^"),resText="",request("http://bing.com?q="+encodeURIComponent(e.query.text),function(r,s,o){if(r)throw r;$=cheerio.load(o);var n=$(".b_caption").slice(0,3),a=$(".b_caption").eq(0).find("cite").text();if(!a.trim().length)return t.end("<dd class'user-q'>"+e.query.text+"</dd><dt class='server-a'>"+n+"</dt>");a=-1!==a.indexOf("http")?a:"http://"+a,console.log(a);var i=e.query.text.toLowerCase(),h=e.query.lang||"eng";if(i=replaceStopWords(i,h),console.log(i),i=i.split(" "),n&&n.length){var l=[];request(a,function(r,s,o){if(r)return t.end("<dd class'user-q'>"+e.query.text+"</dd><dt class='server-a'>"+n+"</dt>");$$=cheerio.load(o.toLowerCase());for(var a=0;a<i.length;a++){var h=$$("p:contains(' "+i[a]+" '),em:contains(' "+i[a]+" '),b:contains(' "+i[a]+" ' ),td:contains(' "+i[a]+" ' ),li:contains(' "+i[a]+" ' )").text(),u=h.indexOf(i[a])-50>0?h.indexOf(i[a]):0;h=h.substr(u,u+700),l.push(h)}l=l.filter(function(e){return""===e.trim()?!1:!0}),console.log("BESTINP"),console.log(l);for(var d=[],a=0;a<l.length;a++)if(0===a&&d.push(l[a]),-1===d.indexOf(l[a]))for(var c=0;c<d.length;c++){if(-1!==l[a].indexOf(d[c])){console.log("none");break}c===d.length-1&&d.push(l[a])}for(var f=[],a=0;a<d.length;a++)for(var p=0;p<i.length;p++)-1!==d[a].indexOf(i[p])?f[a]=f[a]?1+f[a]:1:f[a]=f[a]?f[a]:0;for(console.log(f),finalInputs=[],a=0;4>a;a++){var w=f.indexOf(Math.max(f));if(f[w]<1)break;f.splice(w,1),finalInputs.push(d[a])}n="<dd class'user-q'>"+e.query.text+"</dd><dt class='server-a'><p class='best-answer-crawled lead jumbotron'>"+finalInputs.join("</p><p class='best-answer-crawled lead jumbotron'>")+n+"</dt>",t.end(n)})}else t.end("We cannot provide answer at this time :(")}))}),app.listen(process.env.PORT||8080);