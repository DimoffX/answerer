function replaceStopWords(e,t){return"eng"===t?(e=e.replace(/\s/g,"  "),e.replace(/ (a|about|above|after|against|all|am|an|and|any|are|aren't|as|at|be|because|been|before|being|below|between|both|but|by|can't|cannot|could|couldn't|did|didn't|do|does|doesn't|doing|don't|down|during|each|few|for|from|further|had|hadn't|has|hasn't|have|haven't|having|hehe|'d|he'll|he|here|here's|hers|herself|him|himselfh|is|how|how's|into|is|isn't|it|it's|its|itself|let's|me|more|most|mustn't|my|myself|no|nor|not|of|off|on|once|only|or|other|ought|our|ours|ourselves|out|over|own|same|she|she'd|she'll|she's|should|shouldn't|so|some|such|than|that|that's|the|their|theirs|them|themselves|then|there|there's|these|they|they'd|they'll|they're|they've|this|those|through|to|too|under|until|up|very|was|wasn't|we|we'd|we'll|we're|we've|were|weren't|what|what's|when|when's|where|where's|which|while|who|who's|whom|why|why's|with|won't|would|wouldn't|you|you'd|you'll|you're|you've|your|yours|who|yourself|yourselves) /g," ")):"bul"===t?(e=e.replace(/\s/g,"  "),e.replace(/ (ли|е|а|обаче|въпреки|съм|но|може би|моля|аз|ала|та|че) /g)):void 0}var express=require("express"),bodyParser=require("body-parser"),cookieParser=require("cookie-parser"),app=express(),request=require("request"),cheerio=require("cheerio");app.set("view engine","ejs"),app.use(bodyParser()),app.use(cookieParser()),app.use(express["static"]("public")),app.get("/",function(e,t){t.render("home.ejs")}),app.get("/answer",function(e,t){t.setHeader("Access-Control-Allow-Origin","*"),e.query.text&&e.query.text.length&&(resText="",request("http://bing.com?q="+encodeURIComponent(e.query.text),function(r,s,o){if(r)throw r;$=cheerio.load(o);var n=$(".b_caption").slice(0,3),a=$(".b_caption").eq(0).find("cite").text();if(!a.trim().length)return t.end("<dd class'user-q'>"+e.query.text+"</dd><dt class='server-a'>"+n+"</dt>");a=-1!==a.indexOf("http")?a:"http://"+a,console.log(a);var i=e.query.text.toLowerCase(),h=e.query.lang||"eng";if(i=replaceStopWords(i,h),console.log(i),i=i.split(" "),n&&n.length){var l=[];request(a,function(r,s,o){if(r)return t.end("<dd class'user-q'>"+e.query.text+"</dd><dt class='server-a'>"+n+"</dt>");$$=cheerio.load(o.toLowerCase());for(var a=0;a<i.length;a++){var h=$$("p:contains(' "+i[a]+" '),em:contains(' "+i[a]+" '),b:contains(' "+i[a]+" ' ),td:contains(' "+i[a]+" ' ),li:contains(' "+i[a]+" ' )").text();h=h.substr((h.indexOf(i[a])-50)%1,(h.indexOf(i[a])-50)%1+700),l.push(h)}l=l.filter(function(e){return""===e.trim()?!1:!0}),console.log("BESTINP"),console.log(l);for(var u=[],a=0;a<l.length;a++)if(0===a&&u.push(l[a]),-1===u.indexOf(l[a]))for(var d=0;d<u.length;d++){if(-1!==l[a].indexOf(u[d])){console.log("none");break}d===u.length-1&&u.push(l[a])}for(var c=[],a=0;a<u.length;a++)for(var f=0;f<i.length;f++)-1!==u[a].indexOf(i[f])?c[a]=c[a]?1+c[a]:1:c[a]=c[a]?c[a]:0;for(console.log(c),finalInputs=[],a=0;4>a;a++){var p=c.indexOf(Math.max(c));if(c[p]<1)break;c.splice(p,1),finalInputs.push(u[a])}n="<dd class'user-q'>"+e.query.text+"</dd><dt class='server-a'><p class='best-answer-crawled lead jumbotron'>"+finalInputs.join("</p><p class='best-answer-crawled lead jumbotron'>")+n+"</dt>",t.end(n)})}else t.end("We cannot provide answer at this time :(")}))}),app.listen(process.env.OPENSHIFT_NODEJS_PORT||80);